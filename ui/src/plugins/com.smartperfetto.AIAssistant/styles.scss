// Copyright (C) 2024 The Android Open Source Project
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

// ============================================================================
// AI Chat Panel - Modern Design System
// ============================================================================

// ----------------------------------------------------------------------------
// Theme Variables
// ----------------------------------------------------------------------------

.ai-panel {
  // Light theme (default)
  --chat-bg: #ffffff;
  --chat-bg-secondary: #f7f7f8;
  --chat-bg-tertiary: #ececf1;
  --chat-text: #1a1a1a;
  --chat-text-secondary: #6b7280;
  --chat-text-muted: #9ca3af;
  --chat-border: #e5e7eb;
  --chat-border-light: #f3f4f6;

  // Accent colors
  --chat-primary: #6366f1;
  --chat-primary-hover: #4f46e5;
  --chat-primary-light: rgba(99, 102, 241, 0.1);
  --chat-gradient: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);

  // Message colors
  --chat-user-bubble: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
  --chat-user-text: #ffffff;
  --chat-ai-bubble: #f7f7f8;
  --chat-ai-border: #e5e7eb;

  // Status colors
  --chat-success: #10b981;
  --chat-warning: #f59e0b;
  --chat-error: #ef4444;

  // Shadows
  --chat-shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
  --chat-shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
  --chat-shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);
  --chat-shadow-primary: 0 4px 14px rgba(99, 102, 241, 0.25);

  // Code colors
  --chat-code-bg: #f3f4f6;
  --chat-code-text: #e11d48;

  // Scrollbar
  --chat-scrollbar: #d1d5db;
  --chat-scrollbar-hover: #9ca3af;
}

// Dark theme
.ai-panel[data-theme="dark"],
.ai-panel.dark-theme {
  --chat-bg: #1a1a2e;
  --chat-bg-secondary: #16213e;
  --chat-bg-tertiary: #0f3460;
  --chat-text: #e4e4e7;
  --chat-text-secondary: #a1a1aa;
  --chat-text-muted: #71717a;
  --chat-border: #27272a;
  --chat-border-light: #3f3f46;

  --chat-primary-light: rgba(99, 102, 241, 0.15);

  --chat-ai-bubble: #27272a;
  --chat-ai-border: #3f3f46;

  --chat-code-bg: #27272a;
  --chat-code-text: #f472b6;

  --chat-scrollbar: #3f3f46;
  --chat-scrollbar-hover: #52525b;

  --chat-shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.2);
  --chat-shadow-md: 0 4px 12px rgba(0, 0, 0, 0.3);
  --chat-shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.4);
}

// ----------------------------------------------------------------------------
// Base Panel Layout
// ----------------------------------------------------------------------------

.ai-panel {
  display: flex;
  flex-direction: column;
  height: 100%;
  overflow: hidden;
  background: var(--chat-bg);
  color: var(--chat-text);
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
  font-size: 14px;
  line-height: 1.5;
}

// ----------------------------------------------------------------------------
// Header
// ----------------------------------------------------------------------------

// Compact header - optimized for height
.ai-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 4px 8px;
  min-height: 28px;
  border-bottom: 1px solid var(--chat-border);
  background: var(--chat-bg);
  flex-shrink: 0;
}

.ai-header-left {
  display: flex;
  align-items: center;
  gap: 6px;
}

.ai-header-icon {
  font-size: 16px !important;
  color: var(--chat-primary);
}

.ai-header-title {
  font-size: 12px;
  font-weight: 600;
  color: var(--chat-text);
}

.ai-status-dot {
  width: 5px;
  height: 5px;
  border-radius: 50%;
  background: var(--chat-error);
  flex-shrink: 0;

  &.connected {
    background: var(--chat-success);
  }

  &.disconnected {
    background: var(--chat-error);
  }

  &.backend {
    background: var(--chat-success);
    margin-left: 4px;
  }
}

.ai-status-text {
  font-size: 11px;
  color: var(--chat-text-secondary);

  &.backend {
    font-size: 10px;
    color: var(--chat-success);
  }
}

// Preset question buttons in header
.ai-preset-questions {
  display: flex;
  align-items: center;
  gap: 4px;
  margin-left: 8px;
  padding-left: 8px;
  border-left: 1px solid var(--chat-border);
}

.ai-preset-btn {
  display: flex;
  align-items: center;
  gap: 3px;
  padding: 2px 8px;
  font-size: 11px;
  font-weight: 500;
  color: var(--chat-text-secondary);
  background: var(--chat-bg-secondary);
  border: 1px solid var(--chat-border);
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.15s ease;
  white-space: nowrap;

  .pf-icon {
    font-size: 12px !important;
  }

  &:hover:not(:disabled) {
    color: var(--chat-primary);
    background: var(--chat-bg-hover);
    border-color: var(--chat-primary);
  }

  &:active:not(:disabled) {
    transform: scale(0.95);
  }

  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
}

// Teaching button - special styling for educational content
.ai-teaching-btn {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-color: #667eea;
  font-weight: 600;

  .pf-icon {
    color: white;
  }

  &:hover:not(:disabled) {
    background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
    color: white;
    border-color: #5a67d8;
    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
  }
}

.ai-header-right {
  display: flex;
  align-items: center;
  gap: 2px;
}

.ai-icon-btn {
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: none;
  border-radius: 4px;
  color: var(--chat-text-secondary);
  cursor: pointer;
  transition: all 0.15s ease;
  padding: 0;

  .pf-icon {
    font-size: 16px !important;
  }

  &:hover:not(:disabled) {
    background: var(--chat-bg-secondary);
    color: var(--chat-text);
  }

  &:active:not(:disabled) {
    transform: scale(0.95);
  }

  &:disabled,
  &.uploading {
    opacity: 0.5;
    cursor: not-allowed;
  }
}

// Legacy class names for compatibility
.ai-title {
  display: flex;
  align-items: center;
  gap: 10px;
}

.ai-title-icon {
  width: 28px;
  height: 28px;
  border-radius: 8px;
  background: var(--chat-gradient);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 16px;

  .pf-icon {
    font-size: 18px;
  }
}

.ai-title h2 {
  margin: 0;
  font-size: 15px;
  font-weight: 600;
  color: var(--chat-text);
}

.ai-status {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
  color: var(--chat-text-secondary);

  &::before {
    content: '';
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: var(--chat-success);
  }

  &.disconnected::before {
    background: var(--chat-error);
  }
}

.ai-actions {
  display: flex;
  gap: 4px;
}

.ai-action-btn {
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: none;
  border-radius: 8px;
  color: var(--chat-text-secondary);
  cursor: pointer;
  transition: all 0.15s ease;

  .pf-icon {
    font-size: 20px;
  }

  &:hover {
    background: var(--chat-bg-secondary);
    color: var(--chat-text);
  }

  &:active {
    transform: scale(0.95);
  }
}

// ----------------------------------------------------------------------------
// Messages Container
// ----------------------------------------------------------------------------

.ai-messages {
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
  padding: 4px 6px;
  display: flex;
  flex-direction: column;
  gap: 4px;

  &::-webkit-scrollbar {
    width: 6px;
  }

  &::-webkit-scrollbar-track {
    background: transparent;
  }

  &::-webkit-scrollbar-thumb {
    background: var(--chat-scrollbar);
    border-radius: 3px;

    &:hover {
      background: var(--chat-scrollbar-hover);
    }
  }
}

// Empty state - compact
.ai-empty-state {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px 16px;
  text-align: center;

  .ai-empty-icon {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    background: var(--chat-gradient);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 10px;

    .pf-icon {
      font-size: 20px;
      color: white;
    }
  }

  h3 {
    margin: 0 0 4px;
    font-size: 14px;
    font-weight: 600;
    color: var(--chat-text);
  }

  p {
    margin: 0;
    font-size: 12px;
    color: var(--chat-text-secondary);
    max-width: 240px;
  }
}

// ----------------------------------------------------------------------------
// Message Component
// ----------------------------------------------------------------------------

.ai-message {
  display: flex;
  gap: 6px;
  max-width: 100%;
  animation: messageSlideIn 0.2s ease-out;

  &.ai-message-user {
    align-self: flex-end;
    flex-direction: row-reverse;
    max-width: 85%;
  }

  &.ai-message-assistant {
    align-self: flex-start;
    max-width: 100%;
  }
}

@keyframes messageSlideIn {
  from {
    opacity: 0;
    transform: translateY(12px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

// Avatar - compact for height efficiency
.ai-avatar {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 11px;
  font-weight: 600;

  .pf-icon {
    font-size: 14px;
  }
}

.ai-avatar-user {
  background: var(--chat-gradient);
  color: white;
}

.ai-avatar-assistant {
  background: var(--chat-bg-tertiary);
  color: var(--chat-primary);
  border: 1px solid var(--chat-border);

  .pf-icon {
    background: var(--chat-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
}

// Message Content
.ai-msg-wrapper {
  display: flex;
  flex-direction: column;
  gap: 2px;
  min-width: 0;
  flex: 1;
}

.ai-msg-content,
.ai-bubble {
  padding: 6px 10px;
  border-radius: 10px;
  word-wrap: break-word;
  position: relative;
  flex: 1;
  min-width: 0;
  font-size: 13px;
  line-height: 1.4;

  .ai-message-user & {
    background: var(--chat-user-bubble);
    color: var(--chat-user-text);
    border-radius: 10px 10px 4px 10px;
    box-shadow: var(--chat-shadow-sm);
  }

  .ai-message-assistant & {
    background: var(--chat-ai-bubble);
    border: 1px solid var(--chat-ai-border);
    border-radius: 10px 10px 10px 4px;
    color: var(--chat-text);
  }
}

// Alias for user/assistant bubble
.ai-bubble-user {
  background: var(--chat-user-bubble) !important;
  color: var(--chat-user-text) !important;
  border-radius: 14px 14px 4px 14px !important;
  box-shadow: var(--chat-shadow-sm);
}

.ai-bubble-assistant {
  background: var(--chat-ai-bubble) !important;
  border: 1px solid var(--chat-ai-border) !important;
  border-radius: 14px 14px 14px 4px !important;
  color: var(--chat-text) !important;
}

// Alias for message content text
.ai-msg-text,
.ai-message-content {
  line-height: 1.6;

  p {
    margin: 0 0 8px;

    &:last-child {
      margin-bottom: 0;
    }
  }

  code {
    background: var(--chat-code-bg);
    color: var(--chat-code-text);
    padding: 2px 6px;
    border-radius: 4px;
    font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', monospace;
    font-size: 0.9em;

    .ai-message-user & {
      background: rgba(255, 255, 255, 0.2);
      color: inherit;
    }
  }

  pre {
    margin: 12px 0;
    padding: 12px;
    background: var(--chat-bg-tertiary);
    border-radius: 8px;
    overflow-x: auto;

    code {
      background: none;
      padding: 0;
      color: var(--chat-text);
    }
  }

  strong {
    font-weight: 600;
  }

  a {
    color: var(--chat-primary);
    text-decoration: none;

    &:hover {
      text-decoration: underline;
    }

    .ai-message-user & {
      color: inherit;
      text-decoration: underline;
    }
  }

  ul, ol {
    margin: 8px 0;
    padding-left: 20px;
  }

  li {
    margin: 4px 0;
  }
}

// Message Meta (timestamp, actions)
.ai-msg-meta {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 0 4px;
  opacity: 0;
  transition: opacity 0.15s ease;

  .ai-message:hover & {
    opacity: 1;
  }
}

.ai-msg-time {
  font-size: 11px;
  color: var(--chat-text-muted);
}

.ai-msg-actions {
  display: flex;
  gap: 2px;
}

.ai-msg-action {
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: none;
  border-radius: 4px;
  color: var(--chat-text-muted);
  cursor: pointer;
  transition: all 0.15s ease;

  .pf-icon {
    font-size: 16px;
  }

  &:hover {
    background: var(--chat-bg-secondary);
    color: var(--chat-text);
  }
}

// ----------------------------------------------------------------------------
// Loading / Thinking State - compact
// ----------------------------------------------------------------------------

.ai-thinking {
  display: flex;
  gap: 8px;
  align-self: flex-start;
  max-width: 90%;
}

.ai-thinking-content {
  padding: 8px 12px;
  background: var(--chat-ai-bubble);
  border: 1px solid var(--chat-ai-border);
  border-radius: 14px 14px 14px 4px;
  display: flex;
  align-items: center;
  gap: 6px;
}

.ai-thinking-text {
  font-size: 12px;
  color: var(--chat-text-secondary);
}

.ai-thinking-cursor {
  width: 2px;
  height: 14px;
  background: var(--chat-primary);
  border-radius: 1px;
  animation: cursorBlink 1s infinite;
}

@keyframes cursorBlink {
  0%, 50% { opacity: 1; }
  51%, 100% { opacity: 0; }
}

.ai-typing-dots,
.ai-typing-indicator {
  display: flex;
  gap: 3px;
  padding: 2px 0;
}

.ai-typing-dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: var(--chat-primary);
  animation: dotBounce 1.4s infinite ease-in-out;

  &:nth-child(1) { animation-delay: -0.32s; }
  &:nth-child(2) { animation-delay: -0.16s; }
  &:nth-child(3) { animation-delay: 0s; }
}

@keyframes dotBounce {
  0%, 80%, 100% {
    transform: scale(0.6);
    opacity: 0.4;
  }
  40% {
    transform: scale(1);
    opacity: 1;
  }
}

// ----------------------------------------------------------------------------
// Input Area
// ----------------------------------------------------------------------------

// Input Area - compact for height efficiency
.ai-input-area {
  padding: 6px 8px 8px;
  border-top: 1px solid var(--chat-border);
  background: var(--chat-bg);
  flex-shrink: 0;
}

.ai-input-container,
.ai-input-wrapper {
  display: flex;
  align-items: flex-end;
  gap: 6px;
  padding: 4px 4px 4px 12px;
  background: var(--chat-bg-secondary);
  border: 1px solid var(--chat-border);
  border-radius: 18px;
  transition: all 0.15s ease;

  &:focus-within {
    border-color: var(--chat-primary);
    box-shadow: 0 0 0 2px var(--chat-primary-light);
  }
}

.ai-input {
  flex: 1;
  min-height: 20px;
  max-height: 100px;
  padding: 4px 0;
  border: none;
  background: transparent;
  color: var(--chat-text);
  font-family: inherit;
  font-size: 13px;
  line-height: 1.4;
  resize: none;
  outline: none;

  &::placeholder {
    color: var(--chat-text-muted);
  }

  &:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }
}

.ai-send-btn {
  width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--chat-gradient);
  border: none;
  border-radius: 50%;
  color: white;
  cursor: pointer;
  transition: all 0.15s ease;
  flex-shrink: 0;

  .pf-icon {
    font-size: 16px;
  }

  &:hover:not(:disabled) {
    transform: scale(1.05);
    box-shadow: var(--chat-shadow-sm);
  }

  &:active:not(:disabled) {
    transform: scale(0.95);
  }

  &:disabled {
    background: var(--chat-border);
    cursor: not-allowed;

    .pf-icon {
      opacity: 0.5;
    }
  }

  &.sending {
    background: var(--chat-gradient);

    .pf-icon {
      animation: spin 1s linear infinite;
    }
  }
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.ai-input-hint {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 2px 4px 0;
  font-size: 10px;
  color: var(--chat-text-muted);
}

// Warning message - compact
.ai-warning {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-top: 4px;
  padding: 6px 10px;
  background: rgba(245, 158, 11, 0.1);
  border: 1px solid rgba(245, 158, 11, 0.2);
  border-radius: 6px;
  font-size: 11px;
  color: var(--chat-warning);

  .pf-icon {
    font-size: 14px;
  }
}

// ----------------------------------------------------------------------------
// SQL Result Card
// ----------------------------------------------------------------------------

// SQL Result Card - minimal styling, no extra background
.sql-result,
.ai-sql-card {
  margin-top: 4px;
  border: 1px solid var(--chat-border);
  border-radius: 6px;
  overflow: hidden;
  background: transparent; // No extra background
}

.sql-result-header,
.ai-sql-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 6px 10px;
  background: var(--chat-bg-secondary);
  border-bottom: 1px solid var(--chat-border);
}

.sql-result-title,
.ai-sql-title {
  display: flex;
  align-items: center;
  gap: 6px;

  .pf-icon {
    font-size: 14px;
    color: var(--chat-primary);
  }

  span {
    font-size: 12px;
    font-weight: 600;
    color: var(--chat-text);
  }
}

.sql-result-meta {
  font-size: 11px;
  color: var(--chat-text-secondary);
}

.sql-result-actions,
.ai-sql-actions {
  display: flex;
  gap: 2px;
}

.sql-result-action,
.ai-sql-action-btn {
  display: flex;
  align-items: center;
  gap: 3px;
  padding: 3px 8px;
  background: transparent;
  border: 1px solid var(--chat-border);
  border-radius: 4px;
  font-size: 11px;
  color: var(--chat-text-secondary);
  cursor: pointer;
  transition: all 0.15s ease;

  .pf-icon {
    font-size: 12px;
  }

  &:hover {
    background: var(--chat-primary-light);
    color: var(--chat-primary);
    border-color: var(--chat-primary);
  }

  &.active {
    background: var(--chat-primary);
    color: white;
    border-color: var(--chat-primary);
  }
}

// SQL Query Display - compact
.sql-result-query,
.ai-sql-query {
  padding: 6px 10px;
  background: var(--chat-bg-tertiary);
  border-bottom: 1px solid var(--chat-border);
  font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', monospace;
  font-size: 11px;
  color: var(--chat-text-secondary);
  white-space: pre-wrap;
  word-break: break-all;
  max-height: 60px;
  overflow-y: auto;

  pre {
    margin: 0;
    font-family: inherit;
    font-size: inherit;
    color: inherit;
  }
}

// Table Wrapper - compact
.sql-result-table-wrapper {
  overflow-x: auto;
  max-height: 240px;
  overflow-y: auto;

  &::-webkit-scrollbar {
    width: 5px;
    height: 5px;
  }

  &::-webkit-scrollbar-thumb {
    background: var(--chat-scrollbar);
    border-radius: 2px;
  }
}

// Perfetto-style Table - Clean, minimal design matching official Perfetto UI
.sql-result-table {
  width: 100%;
  border-collapse: collapse;
  font-family: 'Roboto', 'Roboto Condensed', -apple-system, sans-serif;
  font-size: 12px;
  line-height: 1.4;
  table-layout: fixed; // Fixed layout for consistent column widths

  th {
    position: sticky;
    top: 0;
    z-index: 1;
    background: var(--chat-bg);
    padding: 6px 8px;
    text-align: left;
    font-weight: 500;
    font-size: 11px;
    color: var(--chat-text);
    border-bottom: 1px solid var(--chat-border);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 150px; // Limit column header width

    // Right-align numeric headers
    &.col-number,
    &.col-duration,
    &.col-count {
      text-align: right;
    }

    &.sortable {
      cursor: pointer;
      user-select: none;

      &:hover {
        color: var(--chat-primary);
      }
    }

    .sort-icon {
      margin-left: 4px;
      font-size: 10px;
      opacity: 0.6;
    }
  }

  td {
    padding: 4px 8px;
    white-space: nowrap;
    max-width: 200px;
    overflow: hidden;
    text-overflow: ellipsis;
    color: var(--chat-text);
    border-bottom: none; // No cell borders - cleaner look
    font-size: 11px;
    line-height: 1.3;
  }

  tbody tr {
    transition: background 0.1s ease;
    height: 28px; // Fixed row height for consistency

    // No zebra striping - Perfetto style
    &:hover {
      background: rgba(0, 0, 0, 0.04);
    }

    &.clickable {
      cursor: pointer;
    }
  }

  // Name column - primary column, slightly wider
  .col-name {
    font-weight: 400;
    color: var(--chat-text);
    max-width: 180px;
  }

  // Timestamp/time column - clickable, colored
  .col-timestamp,
  .timestamp-cell {
    color: #1a73e8; // Perfetto blue
    cursor: pointer;
    font-family: 'Roboto Mono', 'SF Mono', monospace;
    font-size: 10px;
    max-width: 100px;

    &:hover {
      text-decoration: underline;
    }
  }

  // Entity ID column - clickable for focus tracking (v2.0)
  .entity-cell {
    color: #9c27b0; // Purple for entity IDs
    cursor: pointer;
    font-family: 'Roboto Mono', 'SF Mono', monospace;
    font-size: 10px;
    max-width: 100px;

    &:hover {
      text-decoration: underline;
      background: rgba(156, 39, 176, 0.1);
    }
  }

  // Duration/number columns - right aligned, monospace
  .col-number,
  .col-duration,
  .col-count,
  .number-cell {
    font-family: 'Roboto Mono', 'SF Mono', Monaco, monospace;
    font-size: 10px;
    text-align: right;
    color: var(--chat-text);
    max-width: 80px;
  }

  // Navigation arrow column
  .col-action {
    width: 24px;
    min-width: 24px;
    max-width: 24px;
    text-align: center;
    color: var(--chat-text-secondary);
    font-size: 14px;
  }

  // Null value
  .null-cell {
    color: var(--chat-text-muted);
    font-style: italic;
  }

  // Category/type badges
  .col-category {
    font-size: 10px;
    color: var(--chat-text-secondary);
    max-width: 100px;
  }
}

// Dark theme adjustments for table
.ai-panel[data-theme="dark"] .sql-result-table,
.ai-panel.dark-theme .sql-result-table {
  tbody tr:hover {
    background: rgba(255, 255, 255, 0.05);
  }

  .col-timestamp,
  .timestamp-cell {
    color: #8ab4f8; // Lighter blue for dark mode
  }

  .entity-cell {
    color: #ce93d8; // Lighter purple for dark mode

    &:hover {
      background: rgba(156, 39, 176, 0.15);
    }
  }
}

// Statistics section
.sql-result-stats {
  padding: 8px 12px;
  background: var(--chat-bg-secondary);
  border-bottom: 1px solid var(--chat-border);

  .stats-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }

  .stat-item {
    display: flex;
    flex-direction: column;
    gap: 2px;
    padding: 6px 10px;
    background: var(--chat-bg);
    border-radius: 4px;
    border: 1px solid var(--chat-border-light);
    min-width: 100px;
  }

  .stat-label {
    font-size: 10px;
    font-weight: 500;
    color: var(--chat-text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.3px;
  }

  .stat-value {
    font-size: 12px;
    font-weight: 600;
    color: var(--chat-text);
    font-family: 'Roboto Mono', monospace;
  }
}

// Export buttons section
.sql-result-export {
  display: flex;
  gap: 4px;
  padding: 6px 10px;
  background: var(--chat-bg-secondary);
  border-bottom: 1px solid var(--chat-border);
}

// Expand/Collapse - compact
.sql-result-expand {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 6px;
  background: var(--chat-bg);
  border-top: 1px solid var(--chat-border);

  button {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: 4px 12px;
    background: transparent;
    border: none;
    border-radius: 4px;
    font-size: 12px;
    color: var(--chat-primary);
    cursor: pointer;
    transition: all 0.15s ease;

    &:hover {
      background: var(--chat-primary-light);
    }

    .pf-icon {
      font-size: 16px;
    }
  }

  // 显示限制提示
  .sql-result-limit-note {
    font-size: 11px;
    color: var(--chat-text-secondary);
    margin-left: 8px;
  }
}

// Result Footer - compact
.sql-result-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 4px 10px;
  background: var(--chat-bg-secondary);
  border-top: 1px solid var(--chat-border);
}

.sql-result-footer-actions {
  display: flex;
  gap: 4px;
}

// ----------------------------------------------------------------------------
// Compact Table Design
// ----------------------------------------------------------------------------

// Compact version of SQL result table
.sql-result.compact {
  margin-top: 2px;
  border-radius: 4px;
  width: 100%; // Full width of parent container
  border: none; // Remove border for cleaner look

  // Full width table
  .sql-result-table-wrapper {
    max-height: 280px;
    width: 100%;
    overflow-x: auto;
  }

  .sql-result-table {
    width: 100%;
    min-width: 300px; // Minimum width for consistent appearance
    table-layout: fixed; // Fixed layout to prevent column header wrapping

    th, td {
      padding: 3px 6px;
      font-size: 10px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    th {
      position: sticky;
      top: 0;
      background: var(--chat-bg);
      z-index: 1;
      max-width: 120px; // Limit header width to prevent wrapping
    }

    td {
      max-width: 150px; // Limit cell width
    }

    // Make name/string columns truncate with ellipsis
    .col-name {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 140px;
    }

    // Make action column fixed width
    .col-action {
      width: 24px;
      min-width: 24px;
      max-width: 24px;
    }
  }
}

// Compact single-row header
.compact-header {
  padding: 4px 8px !important;
  min-height: 28px;
  gap: 8px;

  .sql-result-title {
    display: flex;
    align-items: center;
    gap: 6px;
    flex: 1;
    min-width: 0;

    .pf-icon {
      font-size: 14px !important;
      color: var(--chat-primary);
      flex-shrink: 0;
    }

    .section-title {
      font-size: 12px;
      font-weight: 600;
      color: var(--chat-text);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .row-count {
      font-size: 11px;
      font-weight: 400;
      color: var(--chat-text-secondary);
      flex-shrink: 0;
    }

    // Metadata display in header (layer_name, process_name)
    .header-metadata {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-left: 8px;
      padding-left: 8px;
      border-left: 1px solid var(--chat-border);
      flex-shrink: 1;
      min-width: 0;
      overflow: hidden;

      .metadata-tag {
        display: flex;
        align-items: center;
        gap: 3px;
        font-size: 10px;
        background: var(--chat-bg-tertiary, rgba(0,0,0,0.05));
        padding: 2px 6px;
        border-radius: 3px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 180px;

        .metadata-label {
          color: var(--chat-text-secondary);
          font-weight: 500;
        }

        .metadata-value {
          color: var(--chat-text);
          font-family: var(--monospace-font);
        }
      }
    }
  }

  .sql-result-actions {
    gap: 2px;
    flex-shrink: 0;
  }
}

// Icon-only action buttons
.sql-result-action.icon-only {
  width: 24px;
  height: 24px;
  padding: 0;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border-radius: 4px;
  color: var(--chat-text-secondary);
  cursor: pointer;
  transition: all 0.15s ease;

  .pf-icon {
    font-size: 14px !important;
  }

  &:hover {
    background: var(--chat-bg-tertiary);
    color: var(--chat-text);
  }

  &.active {
    background: var(--chat-primary);
    color: white;
  }
}

// Compact statistics section
.compact-stats {
  padding: 4px 8px !important;

  .stats-grid {
    gap: 4px;
  }

  .stat-item {
    padding: 4px 6px;
    min-width: 60px;
  }

  .stat-label {
    font-size: 9px;
  }

  .stat-value {
    font-size: 11px;
  }
}

// Compact expand section
.compact-expand {
  padding: 4px !important;

  button {
    padding: 2px 8px;
    font-size: 11px;
    gap: 2px;

    .pf-icon {
      font-size: 14px !important;
    }
  }
}

// ----------------------------------------------------------------------------
// Settings Modal
// ----------------------------------------------------------------------------

.settings-modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(4px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  animation: fadeIn 0.2s ease-out;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.settings-modal {
  background: var(--chat-bg);
  border-radius: 16px;
  width: 90%;
  max-width: 480px;
  max-height: 85vh;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  box-shadow: var(--chat-shadow-lg);
  animation: slideUp 0.3s ease-out;
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(20px) scale(0.98);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

.settings-modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 20px;
  border-bottom: 1px solid var(--chat-border);

  h3 {
    margin: 0;
    font-size: 16px;
    font-weight: 600;
    color: var(--chat-text);
  }
}

.settings-close-btn {
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: none;
  border-radius: 8px;
  color: var(--chat-text-secondary);
  cursor: pointer;
  transition: all 0.15s ease;

  .pf-icon {
    font-size: 20px;
  }

  &:hover {
    background: var(--chat-bg-secondary);
    color: var(--chat-text);
  }
}

.settings-modal-content {
  padding: 20px;
  overflow-y: auto;
  flex: 1;

  &::-webkit-scrollbar {
    width: 6px;
  }

  &::-webkit-scrollbar-thumb {
    background: var(--chat-scrollbar);
    border-radius: 3px;
  }
}

.settings-section {
  margin-bottom: 24px;

  &:last-child {
    margin-bottom: 0;
  }

  h4 {
    margin: 0 0 12px;
    font-size: 12px;
    font-weight: 600;
    color: var(--chat-text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
}

.settings-field {
  margin-bottom: 16px;

  &:last-child {
    margin-bottom: 0;
  }

  label {
    display: block;
    margin-bottom: 6px;
    font-size: 13px;
    font-weight: 500;
    color: var(--chat-text);
  }

  input[type='text'],
  input[type='password'],
  input[type='number'],
  select {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid var(--chat-border);
    border-radius: 8px;
    background: var(--chat-bg-secondary);
    color: var(--chat-text);
    font-size: 14px;
    transition: all 0.15s ease;

    &:focus {
      outline: none;
      border-color: var(--chat-primary);
      box-shadow: 0 0 0 3px var(--chat-primary-light);
    }
  }
}

.settings-hint {
  margin-top: 4px;
  font-size: 12px;
  color: var(--chat-text-muted);
}

.settings-radio-group {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.settings-radio {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  padding: 12px;
  border: 1px solid var(--chat-border);
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.15s ease;

  &:hover {
    border-color: var(--chat-primary);
    background: var(--chat-primary-light);
  }

  &:has(input:checked) {
    border-color: var(--chat-primary);
    background: var(--chat-primary-light);
  }

  input[type='radio'] {
    margin-top: 2px;
    accent-color: var(--chat-primary);
  }

  .settings-radio-label {
    font-size: 14px;
    font-weight: 500;
    color: var(--chat-text);
  }

  .settings-radio-desc {
    font-size: 12px;
    color: var(--chat-text-secondary);
    margin-top: 2px;
  }
}

.settings-test-btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 8px 14px;
  background: transparent;
  border: 1px solid var(--chat-border);
  border-radius: 8px;
  font-size: 13px;
  color: var(--chat-text);
  cursor: pointer;
  transition: all 0.15s ease;

  &:hover:not(:disabled) {
    border-color: var(--chat-primary);
    color: var(--chat-primary);
  }

  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
}

.settings-test-result {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  margin-left: 12px;
  font-size: 13px;

  &.success {
    color: var(--chat-success);
  }

  &.error {
    color: var(--chat-error);
  }
}

.settings-modal-footer {
  display: flex;
  justify-content: flex-end;
  gap: 8px;
  padding: 16px 20px;
  border-top: 1px solid var(--chat-border);
  background: var(--chat-bg-secondary);
}

.settings-btn {
  padding: 8px 16px;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.15s ease;
}

.settings-btn-secondary {
  background: transparent;
  border: 1px solid var(--chat-border);
  color: var(--chat-text);

  &:hover {
    border-color: var(--chat-text-secondary);
    background: var(--chat-bg-secondary);
  }
}

.settings-btn-primary {
  background: var(--chat-gradient);
  border: none;
  color: white;

  &:hover {
    box-shadow: var(--chat-shadow-primary);
    transform: translateY(-1px);
  }

  &:active {
    transform: translateY(0);
  }
}

// ----------------------------------------------------------------------------
// Navigation Bookmark Bar
// ----------------------------------------------------------------------------

// Navigation Bookmark Bar - compact for height efficiency
.nav-bookmark-bar {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 4px 8px;
  background: var(--chat-bg-secondary);
  border-bottom: 1px solid var(--chat-border);
  overflow-x: auto;
  flex-shrink: 0;

  &::-webkit-scrollbar {
    height: 3px;
  }

  &::-webkit-scrollbar-thumb {
    background: var(--chat-scrollbar);
    border-radius: 1px;
  }
}

.nav-bookmark-nav {
  display: flex;
  gap: 2px;
  flex-shrink: 0;
}

.nav-bookmark-btn {
  width: 22px;
  height: 22px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: 1px solid var(--chat-border);
  border-radius: 4px;
  color: var(--chat-text-secondary);
  cursor: pointer;
  transition: all 0.15s ease;

  .pf-icon {
    font-size: 14px;
  }

  &:hover:not(:disabled) {
    border-color: var(--chat-primary);
    color: var(--chat-primary);
    background: var(--chat-primary-light);
  }

  &:disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }
}

.nav-bookmark-divider {
  width: 1px;
  height: 16px;
  background: var(--chat-border);
  flex-shrink: 0;
}

.nav-bookmark-list {
  display: flex;
  gap: 4px;
  flex: 1;
  min-width: 0;
}

.nav-bookmark-item {
  display: flex;
  align-items: center;
  gap: 3px;
  padding: 2px 8px;
  background: var(--chat-bg);
  border: 1px solid var(--chat-border);
  border-radius: 10px;
  font-size: 10px;
  color: var(--chat-text);
  cursor: pointer;
  white-space: nowrap;
  transition: all 0.15s ease;

  .pf-icon {
    font-size: 12px;
  }

  &:hover {
    border-color: var(--chat-primary);
    background: var(--chat-primary-light);
  }

  &.active {
    border-color: var(--chat-primary);
    background: var(--chat-primary);
    color: white;
  }

  // Type-specific colors
  &.type-jank .pf-icon { color: var(--chat-warning); }
  &.type-anr .pf-icon { color: var(--chat-error); }
  &.type-slow_function .pf-icon { color: var(--chat-warning); }
  &.type-binder_slow .pf-icon { color: var(--chat-primary); }
}

// ----------------------------------------------------------------------------
// Responsive Adjustments
// ----------------------------------------------------------------------------

@media (max-width: 480px) {
  .ai-message {
    max-width: 95%;
  }

  .ai-avatar {
    width: 20px;
    height: 20px;

    .pf-icon {
      font-size: 12px;
    }
  }

  .ai-msg-content {
    padding: 6px 10px;
    font-size: 12px;
  }

  .sql-result-table td {
    max-width: 100px;
    padding: 3px 6px;
  }
}

// ----------------------------------------------------------------------------
// RPC Mode Dialog - Shown when AI Assistant needs RPC mode
// ----------------------------------------------------------------------------

.ai-rpc-dialog {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 24px 20px;
  margin: 12px;
  background: var(--chat-bg);
  border: 1px solid var(--chat-border);
  border-radius: 12px;
  text-align: center;
  animation: fadeIn 0.2s ease-out;
  box-shadow: var(--chat-shadow-md);
}

.ai-rpc-dialog-icon {
  width: 48px;
  height: 48px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--chat-gradient);
  border-radius: 12px;
  margin-bottom: 12px;

  .pf-icon {
    font-size: 24px;
    color: white;
  }

  &.uploading {
    .pf-icon {
      animation: spin 1.5s linear infinite;
    }
  }
}

.ai-rpc-dialog-title {
  margin: 0 0 8px;
  font-size: 16px;
  font-weight: 600;
  color: var(--chat-text);
}

.ai-rpc-dialog-desc {
  margin: 0 0 16px;
  font-size: 13px;
  color: var(--chat-text-secondary);
  line-height: 1.5;
}

.ai-rpc-dialog-actions {
  display: flex;
  gap: 8px;
}

.ai-rpc-dialog-btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 10px 20px;
  border: none;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.15s ease;

  .pf-icon {
    font-size: 18px;
  }

  &.primary {
    background: var(--chat-gradient);
    color: white;
    box-shadow: var(--chat-shadow-primary);

    &:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 20px rgba(99, 102, 241, 0.3);
    }

    &:active {
      transform: translateY(0);
    }
  }

  &.secondary {
    background: var(--chat-bg-secondary);
    color: var(--chat-text);
    border: 1px solid var(--chat-border);

    &:hover {
      background: var(--chat-bg-tertiary);
    }
  }
}

.ai-rpc-dialog-hint {
  margin: 12px 0 0;
  font-size: 11px;
  color: var(--chat-text-muted);

  code {
    background: var(--chat-code-bg);
    color: var(--chat-text-secondary);
    padding: 2px 4px;
    border-radius: 3px;
    font-family: 'SF Mono', Monaco, monospace;
    font-size: 10px;
  }
}

.ai-upload-progress {
  width: 180px;
  height: 3px;
  background: var(--chat-border);
  border-radius: 2px;
  overflow: hidden;
  margin-top: 12px;

  &::after {
    content: '';
    display: block;
    width: 40%;
    height: 100%;
    background: var(--chat-gradient);
    border-radius: 2px;
    animation: progressSlide 1.5s ease-in-out infinite;
  }
}

@keyframes progressSlide {
  0% {
    transform: translateX(-100%);
  }
  50% {
    transform: translateX(150%);
  }
  100% {
    transform: translateX(250%);
  }
}

// Legacy styles - keep for compatibility
.ai-setup-prompt {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 32px 24px;
  margin: 16px;
  background: var(--chat-bg-secondary);
  border: 2px dashed var(--chat-border);
  border-radius: 16px;
  text-align: center;
  animation: fadeIn 0.3s ease-out;
}

.ai-setup-icon {
  width: 64px;
  height: 64px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--chat-gradient);
  border-radius: 50%;
  margin-bottom: 16px;
  box-shadow: var(--chat-shadow-primary);

  .pf-icon {
    font-size: 32px;
    color: white;
  }

  &.uploading {
    animation: pulse 1.5s ease-in-out infinite;

    .pf-icon {
      animation: spin 2s linear infinite;
    }
  }
}

@keyframes pulse {
  0%, 100% {
    box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.4);
  }
  50% {
    box-shadow: 0 0 0 16px rgba(99, 102, 241, 0);
  }
}

.ai-setup-title {
  margin: 0 0 8px;
  font-size: 20px;
  font-weight: 600;
  color: var(--chat-text);
}

.ai-setup-description {
  margin: 0 0 24px;
  font-size: 14px;
  color: var(--chat-text-secondary);
  max-width: 360px;
  line-height: 1.5;
}

.ai-setup-button {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 14px 28px;
  background: var(--chat-gradient);
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  color: white;
  cursor: pointer;
  transition: all 0.2s ease;
  box-shadow: var(--chat-shadow-primary);

  .pf-icon {
    font-size: 20px;
  }

  &:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(99, 102, 241, 0.35);
  }

  &:active {
    transform: translateY(0);
  }
}

.ai-setup-hint {
  margin: 16px 0 0;
  font-size: 12px;
  color: var(--chat-text-muted);

  code {
    background: var(--chat-code-bg);
    color: var(--chat-text-secondary);
    padding: 2px 6px;
    border-radius: 4px;
    font-family: 'SF Mono', Monaco, monospace;
  }
}


// ----------------------------------------------------------------------------
// Content Wrapper & Sidebar Layout
// ----------------------------------------------------------------------------

.ai-content-wrapper {
  display: flex;
  flex: 1;
  min-height: 0;
  overflow: hidden;

  &.with-sidebar {
    .ai-main-content {
      flex: 1;
      min-width: 0;
    }
  }
}

.ai-main-content {
  display: flex;
  flex-direction: column;
  flex: 1;
  min-height: 0;
  overflow: hidden;
}

// ----------------------------------------------------------------------------
// Session Sidebar Styles
// ----------------------------------------------------------------------------

.ai-session-sidebar {
  width: 180px;
  min-width: 180px;
  display: flex;
  flex-direction: column;
  background: var(--chat-bg-secondary);
  border-left: 1px solid var(--chat-border);
}

.ai-session-sidebar-header {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 8px 12px;
  font-size: 11px;
  font-weight: 600;
  color: var(--chat-text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  border-bottom: 1px solid var(--chat-border);

  .pf-icon {
    font-size: 14px;
  }
}

.ai-session-sidebar-items {
  flex: 1;
  overflow-y: auto;
  padding: 4px 0;
}

.ai-session-sidebar-item {
  display: flex;
  align-items: flex-start;
  gap: 8px;
  padding: 8px 12px;
  cursor: pointer;
  transition: background 0.15s ease;
  position: relative;

  &:hover {
    background: var(--chat-bg-tertiary);

    .ai-session-sidebar-item-delete {
      opacity: 1;
    }
  }

  &.current {
    background: var(--chat-primary-light);
    cursor: default;

    &::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 3px;
      background: var(--chat-primary);
    }

    &:hover {
      background: var(--chat-primary-light);
    }
  }
}

// 历史对话分隔线
.ai-session-sidebar-divider {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 8px 12px;
  font-size: 11px;
  color: var(--chat-text-secondary);

  &::before,
  &::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--chat-border);
    margin: 0 8px;
  }
}

.ai-session-sidebar-item-indicator {
  flex-shrink: 0;
  font-size: 8px;
  line-height: 18px;
  color: var(--chat-primary);
}

.ai-session-sidebar-item-content {
  flex: 1;
  min-width: 0;
}

.ai-session-sidebar-item-summary {
  font-size: 12px;
  color: var(--chat-text);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  line-height: 1.3;
}

.ai-session-sidebar-item-meta {
  display: flex;
  align-items: center;
  gap: 4px;
  margin-top: 2px;
  font-size: 10px;
  color: var(--chat-text-muted);
}

.ai-session-sidebar-item-delete {
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 18px;
  height: 18px;
  padding: 0;
  background: transparent;
  border: none;
  border-radius: 3px;
  color: var(--chat-text-muted);
  cursor: pointer;
  opacity: 0;
  transition: all 0.15s ease;

  .pf-icon {
    font-size: 12px;
  }

  &:hover {
    background: var(--chat-error);
    color: white;
  }
}

.ai-session-sidebar-new {
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 8px;
  padding: 8px;
  background: var(--chat-primary);
  border: none;
  border-radius: 6px;
  color: white;
  cursor: pointer;
  transition: all 0.15s ease;

  .pf-icon {
    font-size: 18px;
  }

  &:hover {
    background: var(--chat-primary-hover);
  }
}

// ============================================================================
// Expandable Rows & Summary Styles
// ============================================================================

// 汇总报告样式
.sql-result-summary {
  padding: 12px 16px;
  margin-bottom: 12px;
  background: var(--chat-bg-secondary);
  border-radius: 8px;
  border-left: 3px solid var(--chat-primary);

  .summary-content {
    font-size: 13px;
    line-height: 1.6;
    color: var(--chat-text);

    strong {
      font-weight: 600;
      color: var(--chat-text);
    }

    em {
      font-style: italic;
      color: var(--chat-text-secondary);
    }

    code {
      background: var(--chat-code-bg);
      color: var(--chat-code-text);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace;
      font-size: 12px;
    }
  }
}

// 可展开按钮列
th.col-expand,
td.col-expand {
  width: 30px;
  min-width: 30px;
  text-align: center;
  padding: 6px 4px;

  .expand-icon {
    display: inline-block;
    cursor: pointer;
    color: var(--chat-text-secondary);
    font-size: 10px;
    transition: transform 0.15s ease;
    user-select: none;

    &:hover {
      color: var(--chat-primary);
    }
  }
}

// 展开的行 (matches tr.detail-row rendered in sql_result_table.ts)
tr.detail-row {
  background: var(--chat-bg-secondary);

  td {
    padding: 0;
    border-bottom: 1px solid var(--chat-border);
  }

  .expanded-content {
    padding: 8px 12px;
    max-height: 500px;
    overflow-y: auto;

    // 当只有空数据提示时，减少 padding
    &:has(.expanded-empty.compact) {
      padding: 4px 8px;
    }
  }

  .expanded-error {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px;
    background: rgba(239, 68, 68, 0.1);
    border-radius: 6px;
    color: var(--chat-error);
    font-size: 13px;

    .error-icon {
      font-size: 16px;
    }
  }

  .expanded-empty {
    padding: 12px;
    color: var(--chat-text-muted);
    font-size: 13px;
    text-align: center;

    // 紧凑版本 - 用于空数据提示
    &.compact {
      padding: 6px 12px;
      font-size: 11px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      background: var(--chat-bg-tertiary);
      border-radius: 4px;
      margin: 4px 0;

      .empty-sections {
        font-size: 10px;
        color: var(--chat-text-muted);
        opacity: 0.7;
      }
    }
  }
}

// 展开的内容区域
.expanded-section {
  margin-bottom: 16px;

  &:last-child {
    margin-bottom: 0;
  }

  .section-title {
    font-size: 13px;
    font-weight: 600;
    color: var(--chat-text);
    margin-bottom: 8px;
    padding-bottom: 6px;
    border-bottom: 1px solid var(--chat-border);
  }

  .section-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 12px;

    th {
      text-align: left;
      padding: 6px 8px;
      background: var(--chat-bg-tertiary);
      color: var(--chat-text-secondary);
      font-weight: 500;
      border-bottom: 1px solid var(--chat-border);

      &:first-child {
        border-top-left-radius: 4px;
      }

      &:last-child {
        border-top-right-radius: 4px;
      }
    }

    td {
      padding: 6px 8px;
      color: var(--chat-text);
      border-bottom: 1px solid var(--chat-border-light);
    }

    tr:last-child td {
      border-bottom: none;
    }
  }

  .section-more {
    padding: 8px 12px;
    text-align: center;
    color: var(--chat-text-muted);
    font-size: 12px;
    font-style: italic;
  }
}

// ============================================================================
// HTML Report Link
// ============================================================================

.ai-report-link {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-top: 8px;
  padding: 8px 12px;
  background: var(--chat-bg-secondary);
  border: 1px solid var(--chat-primary);
  border-radius: 6px;
  font-size: 12px;
  color: var(--chat-primary);

  .pf-icon {
    font-size: 14px;
  }

  a {
    display: flex;
    align-items: center;
    gap: 4px;
    color: var(--chat-primary);
    text-decoration: none;
    font-weight: 500;

    &:hover {
      text-decoration: underline;
    }
  }
}

// ----------------------------------------------------------------------------
// Clickable Timestamp Styles
// ----------------------------------------------------------------------------

.ai-clickable-timestamp {
  display: inline-block;
  padding: 2px 8px;
  margin: 0 2px;
  background: var(--chat-code-bg, rgba(0, 0, 0, 0.05));
  border: 1px solid var(--chat-border, #e0e0e0);
  border-radius: 4px;
  font-family: monospace;
  font-size: 0.9em;
  color: var(--chat-primary, #6366f1);
  cursor: pointer;
  transition: all 0.2s ease;

  &::before {
    content: '⏱️ ';
    font-size: 0.85em;
  }

  &:hover {
    background: var(--chat-primary, #6366f1);
    color: white;
    border-color: var(--chat-primary, #6366f1);
    transform: translateY(-1px);
    box-shadow: var(--chat-shadow-sm);
  }

  &:active {
    transform: translateY(0);
  }
}

// ----------------------------------------------------------------------------
// Enhanced Message Content Styles
// ----------------------------------------------------------------------------

.ai-message-content {
  h2 {
    font-size: 1.1em;
    font-weight: 600;
    margin: 8px 0 6px 0;
    color: var(--chat-text);
    display: flex;
    align-items: center;
    gap: 6px;
  }

  h3 {
    font-size: 0.95em;
    font-weight: 600;
    margin: 8px 0 4px 0;
    color: var(--chat-text);
  }

  blockquote {
    margin: 6px 0;
    padding: 6px 10px;
    border-left: 3px solid var(--chat-primary);
    background: var(--chat-bg-secondary);
    border-radius: 0 4px 4px 0;
    color: var(--chat-text);
    font-style: normal;
    font-size: 12px;
  }

  ul {
    margin: 6px 0;
    padding-left: 18px;
    list-style-type: disc;

    li {
      margin: 3px 0;
      line-height: 1.4;
    }
  }

  // 有序列表样式
  ol {
    margin: 4px 0;
    padding-left: 20px;
    list-style-type: decimal;

    li {
      margin: 2px 0;
      line-height: 1.5;
    }
  }

  // 减少标题和紧随其后的列表之间的间距
  h3 + ol,
  h3 + ul {
    margin-top: 2px;
  }

  code {
    background: var(--chat-code-bg);
    color: var(--chat-code-text);
    padding: 2px 6px;
    border-radius: 3px;
    font-family: monospace;
    font-size: 0.9em;
  }

  // Markdown 表格样式
  table {
    width: 100%;
    border-collapse: collapse;
    margin: 6px 0;
    font-size: 12px;
    background: var(--chat-bg);
    border-radius: 6px;
    overflow: hidden;

    th, td {
      padding: 4px 8px;
      text-align: left;
      border-bottom: 1px solid var(--chat-border-light);
    }

    th {
      background: var(--chat-bg-secondary);
      font-weight: 600;
      font-size: 11px;
      color: var(--chat-text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }

    td {
      color: var(--chat-text);
    }

    tr:last-child td {
      border-bottom: none;
    }

    tr:hover td {
      background: var(--chat-bg-secondary);
    }

    // 右对齐数字列
    td:nth-child(2),
    td:nth-child(3) {
      text-align: right;
      font-family: 'Roboto Mono', monospace;
      font-size: 11px;
    }
  }

  // 强调文本
  strong {
    font-weight: 600;
    color: var(--chat-text);
  }

  // 行内代码在受影响帧列表中
  p {
    margin: 4px 0;
    line-height: 1.5;
  }

  // Markdown images (mermaid diagrams, etc.)
  img.ai-markdown-image {
    max-width: 100%;
    height: auto;
    margin: 12px 0;
    border-radius: 8px;
    background: var(--chat-bg);
    border: 1px solid var(--chat-border);
    display: block;

    // Loading state
    &:not([src=""]) {
      min-height: 100px;
    }

    // Error state - show alt text
    &:not([src=""]):not([src^="data:"]) {
      &::after {
        content: attr(alt);
        display: block;
        padding: 12px;
        text-align: center;
        color: var(--chat-text-secondary);
        font-style: italic;
      }
    }
  }

  // Mermaid diagrams (rendered locally)
  .ai-mermaid-block {
    margin: 12px 0;
    padding: 12px;
    border: 1px solid var(--chat-border);
    border-radius: 8px;
    background: var(--chat-bg);
  }

  .ai-mermaid-diagram {
    overflow-x: auto;

    svg {
      max-width: 100%;
      height: auto;
      display: block;
    }
  }

  .ai-mermaid-error {
    padding: 8px;
    color: var(--chat-text-secondary);
    font-style: italic;
    text-align: center;
  }

  .ai-mermaid-details {
    margin-top: 10px;
  }

  .ai-mermaid-actions {
    display: flex;
    justify-content: flex-end;
    padding: 8px 12px 0 12px;
  }

  .ai-mermaid-copy {
    appearance: none;
    border: 1px solid var(--chat-border);
    background: var(--chat-bg-secondary);
    color: var(--chat-text);
    border-radius: 6px;
    padding: 6px 10px;
    font-size: 12px;
    cursor: pointer;

    &:hover {
      border-color: var(--chat-primary);
    }
  }

  .ai-mermaid-source {
    margin: 0;
    padding: 10px 12px;
    background: var(--chat-bg-secondary);
    border-top: 1px solid var(--chat-border);
    font-family: 'Roboto Mono', monospace;
    font-size: 11px;
    line-height: 1.4;
    white-space: pre;
    overflow-x: auto;
  }

  // Links (markdown links)
  a {
    color: var(--chat-primary);
    text-decoration: none;

    &:hover {
      text-decoration: underline;
    }
  }

  // Details/summary for collapsible content
  details {
    margin: 8px 0;
    border: 1px solid var(--chat-border);
    border-radius: 6px;
    overflow: hidden;

    summary {
      padding: 8px 12px;
      background: var(--chat-bg-secondary);
      cursor: pointer;
      font-weight: 500;
      font-size: 12px;
      color: var(--chat-text-secondary);
      user-select: none;
      transition: background 0.15s ease;

      &:hover {
        background: var(--chat-bg-tertiary);
      }

      &::marker {
        color: var(--chat-primary);
      }
    }

    &[open] summary {
      border-bottom: 1px solid var(--chat-border);
    }

    // Content inside details
    > *:not(summary) {
      padding: 8px 12px;
    }
  }
}

// ----------------------------------------------------------------------------
// Severity Badge Styles
// ----------------------------------------------------------------------------

.ai-severity-badge {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 0.8em;
  font-weight: 500;

  &.critical { background: #ffebee; color: #c62828; }
  &.high { background: #fff3e0; color: #ef6c00; }
  &.warning { background: #fffde7; color: #f9a825; }
  &.medium { background: #fffde7; color: #f9a825; }
  &.info { background: #e3f2fd; color: #1565c0; }
  &.low { background: #e8f5e9; color: #2e7d32; }
}

// Dark theme adjustments
.ai-panel[data-theme="dark"],
.ai-panel.dark-theme {
  .ai-clickable-timestamp {
    background: var(--chat-bg-tertiary);
    border-color: var(--chat-border);
  }

  .ai-severity-badge {
    &.critical { background: rgba(198, 40, 40, 0.2); color: #ef5350; }
    &.high { background: rgba(239, 108, 0, 0.2); color: #ffa726; }
    &.warning { background: rgba(249, 168, 37, 0.2); color: #ffca28; }
    &.medium { background: rgba(249, 168, 37, 0.2); color: #ffca28; }
    &.info { background: rgba(21, 101, 192, 0.2); color: #42a5f5; }
    &.low { background: rgba(46, 125, 50, 0.2); color: #66bb6a; }
  }
}

// ----------------------------------------------------------------------------
// Scene Navigation Bar
// ----------------------------------------------------------------------------

.scene-nav-bar {
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding: 8px 12px;
  background: var(--chat-bg-secondary);
  border-bottom: 1px solid var(--chat-border);
}

.scene-nav-header {
  display: flex;
  align-items: center;
  gap: 12px;
}

.scene-nav-label {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: 12px;
  font-weight: 600;
  color: var(--chat-text);

  i {
    font-size: 14px;
    color: var(--chat-primary);
  }
}

.scene-nav-count {
  font-size: 11px;
  color: var(--chat-text-secondary);
}

.scene-nav-loading {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: 11px;
  color: var(--chat-text-secondary);

  .spinning {
    animation: spin 1s linear infinite;
  }
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.scene-nav-refresh {
  margin-left: auto;
  padding: 4px;
  background: transparent;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  color: var(--chat-text-secondary);
  transition: all 0.15s ease;

  &:hover:not(:disabled) {
    background: var(--chat-bg-tertiary);
    color: var(--chat-primary);
  }

  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  i {
    font-size: 16px;
  }
}

.scene-nav-chips {
  display: flex;
  align-items: center;
  gap: 6px;
}

.scene-nav-arrow {
  flex-shrink: 0;
  padding: 4px 6px;
  background: var(--chat-bg);
  border: 1px solid var(--chat-border);
  border-radius: 4px;
  cursor: pointer;
  color: var(--chat-text-secondary);
  transition: all 0.15s ease;

  &:hover:not(:disabled) {
    background: var(--chat-bg-tertiary);
    color: var(--chat-primary);
    border-color: var(--chat-primary);
  }

  &:disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }

  i {
    font-size: 14px;
  }
}

.scene-nav-chips-scroll {
  display: flex;
  gap: 6px;
  overflow-x: auto;
  flex: 1;
  padding: 2px 0;

  &::-webkit-scrollbar {
    height: 4px;
  }

  &::-webkit-scrollbar-track {
    background: transparent;
  }

  &::-webkit-scrollbar-thumb {
    background: var(--chat-scrollbar);
    border-radius: 2px;
  }
}

.scene-chip {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 4px 8px;
  background: var(--chat-bg);
  border: 1px solid var(--chat-border);
  border-radius: 16px;
  cursor: pointer;
  white-space: nowrap;
  font-size: 11px;
  transition: all 0.15s ease;

  &:hover {
    background: var(--chat-bg-tertiary);
    border-color: var(--chat-primary);
  }

  &.active {
    background: var(--chat-primary);
    border-color: var(--chat-primary);
    color: white;

    .scene-chip-duration {
      color: rgba(255, 255, 255, 0.8);
    }
  }
}

.scene-chip-rating {
  font-size: 10px;
}

.scene-chip-icon {
  font-size: 12px;
}

.scene-chip-label {
  font-weight: 500;
  color: var(--chat-text);

  .scene-chip.active & {
    color: white;
  }
}

.scene-chip-duration {
  font-size: 10px;
  color: var(--chat-text-secondary);
  padding-left: 4px;
  border-left: 1px solid var(--chat-border);
}

.scene-nav-empty {
  font-size: 11px;
  color: var(--chat-text-muted);
  font-style: italic;
}
